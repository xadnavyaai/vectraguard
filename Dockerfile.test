# Test Dockerfile for Vectra Guard
# Provides isolated testing environment with all necessary tools

FROM golang:1.25-alpine

# Install basic tools (including tail)
RUN apk add --no-cache \
    bash \
    git \
    make \
    docker-cli \
    curl \
    jq \
    coreutils

# Install bubblewrap for namespace testing (if available)
RUN apk add --no-cache bubblewrap 2>/dev/null || true

# Set working directory
WORKDIR /workspace

# Copy go.mod and go.sum (if they exist)
COPY go.mod ./
COPY go.sum* ./

# Download dependencies
RUN go mod download

# Copy the rest of the code
COPY . .

# Default command (build happens at runtime)
CMD ["make", "test"]

