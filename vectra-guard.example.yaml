# Vectra Guard
# Simple, clean, rock solid protection

# ============================================
# QUICK START PRESETS (Copy & Paste)
# ============================================

# PRESET 1: DEVELOPER (Recommended)
# Best for local development. Fast, unobtrusive, but safe.
#
# guard_level:
#   level: auto
#   allow_user_bypass: true
# sandbox:
#   enabled: true
#   mode: auto              # Sandbox only risky commands
#   security_level: balanced
#   enable_cache: true      # 10x faster subsequent runs
#   network_mode: restricted # Allow outbound, block inbound

# PRESET 2: CI/CD PIPELINE
# For automated testing and builds.
#
# guard_level:
#   level: high
# sandbox:
#   enabled: true
#   mode: always            # Sandbox everything
#   security_level: strict
#   enable_cache: true

# PRESET 3: PRODUCTION
# Maximum security for production environments.
#
# guard_level:
#   level: paranoid         # Require approval for everything
# sandbox:
#   enabled: true
#   mode: always
#   security_level: paranoid
#   network_mode: none

# ============================================
# MAIN CONFIGURATION
# ============================================

# GUARD LEVEL (Auto-Detection Recommended)
#
# Controls WHAT requires approval or is blocked.
# Options: auto (recommended), low, medium, high, paranoid
#
# 'auto' intelligently detects context:
#   - Local dev branch → low/medium
#   - Production branch → paranoid
#   - "deploy" command → high
guard_level:
  level: auto
  
  # Override with: VECTRA_GUARD_LEVEL=low vg exec ...
  allow_user_bypass: true
  bypass_env_var: VECTRAGUARD_BYPASS

# SANDBOX EXECUTION
#
# Controls WHERE commands run (Host vs Sandbox).
sandbox:
  enabled: true
  
  # WHEN to sandbox:
  # - auto:   Sandbox only medium/high risk commands (Recommended)
  # - always: Sandbox everything (Safest)
  # - risky:  Sandbox only high/critical risk
  mode: auto
  
  # HOW STRICT the sandbox is:
  # - permissive: Fast, shares host network
  # - balanced:   Good isolation, allowed outbound net (Recommended)
  # - strict:     Stronger isolation, limited capabilities
  # - paranoid:   No network, read-only root, minimal caps
  security_level: balanced
  
  # RUNTIME:
  # - auto:   Best available (Docker > Podman > Namespace)
  # - docker: Most compatible
  runtime: auto
  
  # PERFORMANCE:
  # Enable caching to speed up installs (npm, pip, go, etc.)
  enable_cache: true
  
  # Network access for sandbox
  network_mode: restricted

# ============================================
# ENVIRONMENT DETECTION
# ============================================

# Teach Vectra Guard your organization's patterns
production_indicators:
  # Git branches that indicate production
  branches:
    - main
    - master
    - production
    - release
  
  # Keywords in URLs, hostnames, database names, paths
  keywords:
    - prod
    - production
    - prd
    - live
    - staging
    - stg
    # Add your org's patterns:
    # - uat
    # - preprod

# ============================================
# LOGGING & POLICIES
# ============================================

logging:
  format: json  # Options: json, text

policies:
  # Git Operations
  monitor_git_ops: true
  block_force_git: true  # Block git push --force
  
  # Production Environment Detection
  detect_prod_env: true
  
  # SQL Detection (only flag destructive operations by default)
  only_destructive_sql: true
  
  # Commands always allowed (safe operations)
  allowlist:
    - "echo *"
    - "ls *"
    - "cat *"
    - "pwd"
    - "git status"
    - "git diff"
    - "git log"
    - "npm install"
    - "npm test"
    - "npm run build"
  
  # Commands blocked or requiring approval
  denylist:
    - "rm -rf /"
    - "sudo rm"
    - ":(){ :|:& };:"  # fork bomb
    - "curl * | sh"
    - "wget * | bash"
    - "git push --force"
    - "DROP DATABASE"
    - "DROP TABLE"

# ============================================
# ENVIRONMENT VARIABLE PROTECTION (Optional)
# ============================================

env_protection:
  enabled: true
  masking_mode: partial  # full, partial, hash, fake
  block_dotenv_read: true

# ============================================
# SANDBOX SETTINGS (Default: Always Enabled)
# ============================================

sandbox:
  enabled: true
  mode: always  # Options: always, auto, risky, never
                # - always: Always sandbox (default, maximum security)
                # - auto: Auto-sandbox medium+ risk commands
                # - risky: Only sandbox high/critical risk
                # - never: Never sandbox (except critical commands cannot be bypassed)
  security_level: balanced  # balanced, permissive, strict, paranoid
  runtime: auto  # auto-detect best runtime (bubblewrap > docker > podman)
  image: ubuntu:22.04
  
  # To disable sandbox completely:
  # enabled: false
  # OR
  # mode: never
  
  # Performance optimizations
  enable_cache: true  # Enable caching for 10x speedup (default)
  timeout: 600  # 10 minutes for long builds
  
  # Comprehensive cache directories (auto-detected)
  # cache_dirs:
  #   - ~/.npm
  #   - ~/.yarn
  #   - ~/.pnpm
  #   - ~/.cache/pip
  #   - ~/.cargo
  #   - ~/go/pkg
  #   - ~/.m2
  #   - ~/.gradle
  #   - ~/.gem
  #   - ~/.cache/composer
  #   - ~/.cache/nuget
  
  # Network configuration
  network_mode: restricted  # restricted, full, none
  allow_network: true  # Allow network for package installs
  
  # Environment variables to pass through
  env_whitelist:
    - HOME
    - USER
    - PATH
    - SHELL
    - TERM
    - LANG
    - LC_ALL
    - PWD
    - OLDPWD
    - NODE_ENV
    - NPM_TOKEN
    - GITHUB_TOKEN
    - DOCKER_HOST
    - CI
    - TRAVIS
    - CIRCLE
    - JENKINS
  
  # Observability
  enable_metrics: true  # Track performance metrics
  log_output: false  # Don't log command output by default
  
  # Trust store path (for "approve and remember")
  # trust_store_path: ~/.vectra-guard/trust.json
